# 开发流程与规范

## ※ 产品策划

## ※ 三维建模

### 一、场景

### 二、道具(次世代)

#### 1.建模

> 搜集参考图

- 创建文件夹，以英文名称命名(一般由《开发计划表》提供)，如：Prop Name。目录结构参见<Pic1>
- 根据需求文档中指定的道具或型号搜索相关图片，保存于“Prop Name/Pics”文件夹中，名称以数字序号命名，如1、2、3，格式不限
- 素材来源包括但不限于官方网站、电商平台、搜索引擎
- 重要道具需通过视频进行观察学习，了解其工作原理、动画机制
- 查询道具相关尺寸参数，以图片或文字方式保存

> 观察

- 从各个角度仔细观察道具，根据结构、材质、连续性对模型整体进行拆分，确定有哪些网格、尺寸以及它们的衔接方式
- 网格的定义：拥有名称的、独立的最大连通集，手动附加的除外。Max中称为对象，我们称其为网格或网格对象
- 划分网格对象的主要依据有：(1) 明显的非连续结构；(2) 材质不同；(3) 虽是连续结构，但布线难度过大
- 单独分析每个网格，找到最相近的基本几何体，并思考所需用到的修改器和命令，脑中推演制作过程
- 创建【参考】层
- 创建box，**归至原点**，依据实际尺寸设置长宽高
- (可选) 若有清晰的、透视度低的正、侧视图，可创建plane，plane与图片横纵比保持一致，贴上该图，放在合适位置，并整体缩放至实际尺寸

> 搭建原型(中模)

- 创建【原型】层
- 以观察阶段划分的网格为依据，分别制作原型
- 横平竖直。道具多为规则模型，应按照道具理论形态进行建模，不要考虑实际生产加工造成的误差，如：篮球就是球形，房子就是长方体，木板的厚度就是一致的<Pic2>
- 工具调形。尽可能使用修改器达到理想形态，避免手动调整顶点
- **考虑高模**。(1) 模型布线应呈方形网格状；(2) 转角处应能够使用快速循环命令进行卡线；(3) 多边形的面若是会造成卡线混乱，则：删面-->封口-->插入-->删面，此方法为“走线归一法”；<Pic3>(4) 对于“平面挖洞”需求，制作平面面片-->添加厚度-->删除端面-->端面封口-->插入保护线-->制作洞形面片-->对齐高度-->添加厚度-->全选侧面-->挤出保护线-->删除厚度-->附加-->桥接；<Pic4>(5) 对于不重要的凹槽结构，中模阶段无需制作，可记录到“Prop Name/待办.txt”文件中，在法线后处理阶段进行制作
- 合理选参。(1)球、圆柱形结构，一般选16-20段，大型、可见度高或视距近的选32-48；(2)圆角结构，一般选4段，大型、可见度高或视距近的选6-12段；(3)对于需要桥接的不同形状，选择可以匹配的段数，如：圆角矩形与圆柱桥接，若圆柱是20段，则圆角矩形每个角应切为4段(  (4+1) * 4  )
- 同形复用。对于相同网格，使用**对称**、**实例**等关联方式进行统一编辑，提高效率。制作高模、低模时，全选复制，不会破坏它们的关系，如A、B为实例关系，选中它们并复制出A1、B1，则A1、B1仍为实例关系，但与A、B没有任何关系
- 面数优化。(1) 删除插入其它网格内部的面；<Pic5>(2) 删除带壳管状结构的内部底面；<Pic6>(3) 删除不影响外形轮廓的圈线
- 设置平滑。中模阶段最后，需保证每个网格的平滑组都处于合理状态，具体设置方法是：进入面级别-->全选面-->自动平滑-->分别选择与周围不连续平滑的部分，自动平滑<Pic7>

> 制作高模

- 全选中模，复制，创建【高模】层
- 对网格转角处进行卡线-->涡轮平滑操作。
- 转角必卡。转角处两侧必须卡线
- 软硬有度。根据真实外形与材质，通过卡线远近对圆润度进行控制。如：金属转角较为尖锐，塑料转角较为圆润，具体以实物图为准
- 指数增距。对于中间平整部分较长的模型，两端卡线后，可在中间以指数倍增加的间隔补充卡线<Pic8>
- 补充细节。对于实物表面存在的凸起结构，如细小纹理、浮雕、文字图案等，进行单独制作，完成后添加涡轮平滑观察效果，达标后**删除涡轮平滑**，附加至网格表面；对于凹陷结构，按照【法线后处理】执行

> 制作低模

- 全选中模，复制，创建【低模】层
- 分别对各网格对象进行拆线、平滑操作
- **拆线原则**：(1) 完全不破坏中模轮廓；(2) 面数降到最低；(3) 只允许出现三、四边面；(4) 若出现面拉扯过大的情况，即两条边夹角过小，可适当加线优化
- 对于连通的对称结构，塌陷-->删中线
- 平滑操作同中模。**注：低模平滑组确定后，不可再做更改，应保持后续的低模-法线、低模-AO平滑组的统一**

> 展UV

- 分别对低模网格进行：转为可编辑网格-->UV移出-->转为可编辑多边形-->UV展开-->快速剥-->松弛-->摆正
- 对于实例网格，不采用上述操作，否则会破坏实例关系，使用基础方式；**也可在搭建原型阶段将UV展好，再进行实例、对称**
- 正向松弛。UV线条需保证呈横平竖直状，利用对齐工具调正，方向也需摆正，扭曲的管状结构要视为直管进行操作
- 隐藏接缝。UV接缝选在视觉无法达到或容易忽略的地方
- 最终整合。所有网格UV展开完成后，全选网格-->转为可编辑多边形(对实例网格使唯一)-->UV展开-->填充设为0.001-->紧缩规格化
- 细节放大。对于体积小但材质细节丰富的网格，选中-->等比放大-->去选“重缩放”-->紧缩规格化，**该步骤直接关系到贴图精度与最终模型效果，应借助棋盘格仔细调整**
- 导出指定分辨率的UV贴图，命名为“Prop Name_UV.tga”，保存于“Prop Name/Textures”文件夹中

#### 2.烘焙

> 法线贴图

- 全选低模，复制，创建【低模-法线】层
- 分别对网格对象进行**定值**的偏移操作，使所有网格之间保持一定距离，并附加在一起
- 全选高模，复制，创建【高模-法线】层
- 与低模做相同操作，使每个网格对象的位置与低模完全对齐，塌陷涡轮平滑，并附加在一起
- 烘焙法线贴图：选择低模-->打开渲染到纹理-->启用投影贴图-->选取->拾取高模-->选项->绿轴朝上->添加法线通道-->设置路径-->设置分辨率(默认2048，特殊情况会在《开发计划表》中另外说明)-->调整框架，使框架完全包裹住高模，且不高出太多-->渲染
- 贴图命名为“Prop Name_NM.tga”，保存于“Prop Name/Textures”文件夹中
- **贴图修正**。Max烘焙出的法线贴图，会随机出现斑点或油渍状等不可预知的纹路，建议导入SP、Unity等渲染引擎观察法线贴图效果，根据具体情况对贴图在PS中做处理

> 法线后处理

- 创建【法线后处理】层，对于制作高模阶段所遗留的难以直接制作的凹陷结构，采用单独烘焙的方法
- 具体做法：创建正方形plane，尺寸为100cm*100cm，再制作对应的凹陷结构，按上述方法烘焙法线贴图，命名不强制要求，可使用中文，后缀使用“\_N”，保存于“Prop Name/Textures”文件夹中
- 在PS中将凹陷结构的法线**叠加**至原图中
- 贴图命名为“Prop Name_N.tga”，保存于“Prop Name/Textures”文件夹中

> 环境光遮蔽(AO)贴图

- 全选低模，复制，创建【低模-AO】层
- 对于有动画需求的模型(一般由《开发计划表》提供说明)，应根据是否会产生相对位移、旋转对网格进行分组，组之间参考法线烘焙的流程进行定值偏移操作，并附加在一起
- 导出低模，使用[导出选定对象]，命名为“Prop Name_L.fbx”，保存于“Prop Name”文件夹中
- 全选高模，复制，创建【高模-AO】层
- 与低模做相同操作，使每个网格对象的位置完全对齐，塌陷涡轮平滑，并附加在一起
- 导出高模，使用[导出选定对象]，命名为“Prop Name_H.fbx”，保存于“Prop Name”文件夹中
- 将**低模AO**(Prop Name_L.fbx)导入SP-->模板选择PBR-Specular Glossiness-->指定分辨率-->法线贴图格式选择OpenGL-->添加(处理完成的)**法线贴图**(Prop Name_N.tga)-->OK
- 在Texture Set Settings中指定法线贴图
- **烘焙AO**。点击[烘焙模型贴图]-->指定分辨率-->选择**高模AO**(Prop Name_H.fbx)-->抗锯齿=子采样8x8-->去选除AO以外的其它通道-->点击AO-->[衰减]=光滑
- 导出贴图至“Prop Name/Textures/SP”文件夹中(此贴图无法命名)
- SP项目文件命名为"Prop Name_SP.spp"，保存于“Prop Name/Textures”文件夹中

#### 3.材质

> 制作材质

- 按实物图片制作材质
- 贴图保存于“Prop Name/Textures/SP”文件夹中

> 导出贴图

- 分别将SP中的Diffuse、Normal、AO、Specular、Glossiness贴图导入PS对应文件夹
- 添加文字、图片等元素
- 将Glossiness图片全选复制，粘贴到Alpha通道
- 漫反射贴图：命名为“Prop Name_Diffuse.tga”，16位，“Prop Name/Prop Name”文件夹中
- 法线贴图(从SP导出的需翻转G通道)：命名为“Prop Name_Normal.tga”，16位，保存于“Prop Name/Prop Name”文件夹中
- AO贴图：命名为“Prop Name_AO.tga”，16位，保存于“Prop Name/Prop Name”文件夹中
- 高光/光滑度贴图：命名为“Prop Name_SpecGloss.tga”，32位，保存于“Prop Name/Prop Name”文件夹中

#### 4.成品

> 模型、子模型(子物体)、网格、UV、材质、着色器、贴图的关系

- 举例说明上述名词：

  模型：一辆车(的主体)

  子模型：车轮、车门、方向盘等部件

  网格：车体的外壳与内饰，都属于主体，但是是不同的网格，穿插结构

  UV：所有网格的UV集

  材质：一个模型或子模型可指定1-N个材质，一般为1个

  着色器：材质的表现形式，一个材质只能指定一个着色器

  贴图：一个材质可包含多张通道贴图

> 规范化

- 全选低模，复制，创建【成品】层
- 组合。根据动画需求对网格对象进行附加，参考AO层的摆放原则，不允许出现：两个模型烘焙AO时在一起，但做动画时会分开的情况
- 调轴。对每个组件(合并后的网格)分别调整坐标轴方向，Z轴指向组件的理论前方，X轴指向组件的理论左方，Y轴指向组件的理论上方。对于曾做过缩放操作的组件，须先重置变换
- 链接。从逻辑角度出发，指定组件间的父子关系，并链接
- 命名。对组件进行规范命名。如：Prop Name、Prop Name Com1、Prop Name Com2、Prop Name Com3

> 指定材质组

- 一般情况下，一个模型对应一个UV集，模型与子模型可以使用同一材质以及同一套贴图
- **对于每个模型或子模型**，有发光、透明等特殊材质时(由《开发计划表》提供说明)，需将该元素在Max中使用不同序号的材质标记。具体做法为：选择模型或子模型，指定材质1，进入元素级别，选择不同材质的元素，指定材质2、3等
- 即使是同一材质，如两块透明度不同的玻璃，两个发光强度不同的灯泡，也要分开标记
- 对于精度要求较高的较为复杂的模型，UV也可进行适当地分组。如上述车主体，可以分别将外壳、内饰分为两个UV集，即使最终导出时附加在了一起，只要将内外材质标记区分，便可以指定不同贴图
- 对于有无缝贴图需求的元素，也要分开标记

> 导出

- 全选组件-->选择游戏导出器-->导出当前选择-->勾选平滑组-->去选嵌入媒体，命名为“Prop Name.fbx”，保存于“Prop Name/Prop Name”文件夹中

> 打包输出

- 此时"Prop Name/Prop Name"文件夹下包含1个可用模型+4个通道贴图

### 三、人物角色

### 四、动画

#### 1.常规动画

#### 2.角色动画

> 骨骼绑定

- XXX

> 骨骼动画

- XXX

> 表情变形

- XXX

## ※ UI设计

## ※ 多媒体

## ※ 客户端编程

## ※ 服务端编程

